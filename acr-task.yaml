version: v1.1.0
steps:
  - cmd: bash echo REGISTRY_URL= {{.Values.REGISTRY_URL}}
  - cmd: bash echo {{.Secrets.REGISTRY_PUBLIC_USER}}
  - cmd: bash echo REGISTRY_PUBLIC_USER= {{.Values.REGISTRY_PUBLIC_USER}}
  - cmd: bash echo REGISTRY_PUBLIC_PASSWORD= {{.Values.REGISTRY_PUBLIC_PASSWORD}}
  - cmd: docker login {{.Values.REGISTRY_URL}} --username registry-public-user --password j9u+seZcaWCrbR6DhHf+=YhtVEPxtiWG
  # Log in to Docker Hub
  - cmd: docker login {{.Values.REGISTRY_URL}} --username '{{.Secrets.REGISTRY_PUBLIC_USER}}' --password '{{.Secrets.REGISTRY_PUBLIC_PASSWORD}}'
  # Build 
  - id: build-hello-world
    build: -t {{.Run.Registry}}/hello-world:{{.Run.ID}} --build-arg REGISTRY_URL={{.Values.REGISTRY_URL}} -f Dockerfile .
  - id: push-images
    when: ['build-hello-world']
    push: 
    - "{{.Run.Registry}}/hello-world:{{.Run.ID}}"
